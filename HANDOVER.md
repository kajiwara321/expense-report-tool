# 経費レポートツール - 引き継ぎドキュメント

## プロジェクト概要

経費データを入力し、自動的に分類・集計してレポートを生成するツールです。
OpenAI Agents SDKを使用して、経費の分類と集計レポートの生成を行います。

## バージョン情報

現在のバージョン: v0.1.0 (初期実装)
- ローカル環境での経費精算基本機能の実装
- コマンドライン入力による経費データ処理
- AIによる自動分類と集計レポート生成

## セットアップ手順

1. リポジトリのクローン
```bash
git clone https://github.com/[your-username]/expense-report-tool.git
cd expense-report-tool
```

2. 環境のセットアップ
```bash
./setup.sh
source venv/bin/activate
```

3. APIキーの設定
- `.env`ファイルに以下を設定：
```
OPENAI_API_KEY=your-api-key-here
DEBUG=false  # デバッグ出力を有効にする場合は true
```

## 現状の実装

### 機能
- 経費データの対話的な入力
- AIによる経費の自動分類
- 分類された経費データからのレポート生成
- 堅牢なJSON解析処理
- デバッグモードのサポート

### ファイル構成
- `expense_report_tool.py`: メインの実装ファイル
- `README_expense_tool.md`: 使用方法の説明
- `HANDOVER_expense_tool.md`: このドキュメント
- `test_api_key.py`: APIキー検証用スクリプト

### 実装の詳細

1. 経費分類エージェント
- 入力: 経費情報（項目名、日付、金額、詳細）
- 出力: JSON形式の分類結果（カテゴリ、金額、日付、説明、有効性）
- 改善: 堅牢なJSON形式の処理実装

2. レポート生成エージェント
- 入力: 分類済み経費データのリスト
- 出力: フォーマット済みの経費レポート
  - 合計金額
  - カテゴリ別集計
  - 高額支出の検出（¥5,000以上）
  - 特記事項の自動生成

3. エラーハンドリング
- JSON解析エラーの自動修復機能
- デバッグモードによる詳細情報の出力
- ユーザーフレンドリーなエラーメッセージ

## 解決済みの課題

1. JSON処理の安定化
- 実装: safe_json_parse関数による堅牢な解析
- カンマ処理の改善
- エラー時の適切なフォールバック

2. APIキー管理
- .envファイルによる安全な管理
- 起動時の有効性チェック
- テストスクリプトの提供

3. エラー出力の制御
- デバッグモードの実装
- 適切なエラーメッセージ
- トレース出力の制御

## 今後の展開計画

### フェーズ1: OCR実装 (Next)
- 領収書の画像からのデータ抽出
- テキスト認識精度の向上
- 画像前処理の最適化

### フェーズ2: Web実装
- Webインターフェースの開発
- ユーザー認証システム
- クラウドストレージ連携

### フェーズ3: 拡張機能
- 経費データの永続化（データベース実装）
- レポートテンプレートのカスタマイズ
- 承認ワークフローの実装
- 経費データの分析・可視化

## 開発環境

- Python 3.9以上
- OpenAI API
- 必要なパッケージ:
  - openai-agents
  - python-dotenv
  - （今後）OCRライブラリ
  - （今後）Webフレームワーク

## テスト方法

1. APIキーのテスト
```bash
python test_api_key.py
```

2. 基本機能のテスト
```bash
python expense_report_tool.py
```

入力例：
```
タクシー代 2024年3月13日 ¥1,500 東京駅から会社まで
昼食代 2024年3月13日 ¥2,800 取引先との打ち合わせ
会議室利用料 2024年3月13日 ¥15,000 取引先との商談
```

## デバッグ方法

1. デバッグモードの有効化
```
# .envファイルで設定
DEBUG=true
```

2. デバッグ情報の確認
- JSON解析の中間状態
- APIレスポンスの詳細
- エラーのスタックトレース

## 既知の制限事項

1. 入力形式
- 現状はコマンドライン入力のみ
- 日付形式は限定的

2. データ永続化
- 現状はメモリ内のみ
- セッション終了で消去

3. レポート形式
- 固定テンプレート
- カスタマイズ不可

## 推奨される拡張

1. 入力の多様化
- CSVファイルのインポート
- Excelファイルの対応
- 画像からのOCR入力

2. データ管理
- データベース実装
- バックアップ機能
- データのエクスポート

3. UI/UX改善
- Webインターフェース
- モバイル対応
- 直感的な操作性

## リファレンス

- [OpenAI API Documentation](https://platform.openai.com/docs/api-reference)
- [Python Documentation](https://docs.python.org/)
- [Project GitHub Repository](https://github.com/[your-username]/expense-report-tool)

## 連絡先

問題や質問がある場合は、以下に連絡してください：
- GitHub Issues
- プロジェクトメンテナー: [連絡先情報]
